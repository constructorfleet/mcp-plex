version: "3.9"

services:
  qdrant:
    image: qdrant/qdrant
    ports:
      - "6333:6333"
  loader:
    build: .
    environment:
      PLEX_URL: ${PLEX_URL}
      PLEX_TOKEN: ${PLEX_TOKEN}
      TMDB_API_KEY: ${TMDB_API_KEY}
      QDRANT_URL: http://qdrant:6333
    depends_on:
      - qdrant
    command: load-data --continuous
  mcp-plex:
    build: .
    environment:
      PLEX_URL: ${PLEX_URL}
      PLEX_TOKEN: ${PLEX_TOKEN}
      TMDB_API_KEY: ${TMDB_API_KEY}
      QDRANT_URL: http://qdrant:6333
    depends_on:
      - qdrant
    command: mcp-server --transport sse --bind 0.0.0.0 --port 8000 --mount /mcp
    ports:
      - "8000:8000"
